### 1 虚拟内存和物理内存

虚拟内存的概念：

​		以32位操作系统为例，系统的寻址空间只有4G，最大物理内存也为4G。运行在操作系统上的进程，它的寻址空间也是4G，也就是说，在进程看来这一块4G的连续内存都是它的，它可以敞开了用。但是事实上进程肯定是无法使用所有的物理内存的，在多个进程的情况下，如果每个进程都能访问4G的物理内存，那进程就可以修改其他进程的数据，系统就乱套了。

​		所以操作系统引入了虚拟内存，可以看作操作系统对进程进行了“欺骗“，在进程看来它可以使用4G的内存，但实际上它可能只能使用物理内存上的一小块。具体的做法是在进程的虚拟内存和物理内存之间有一个**页表**来进行**内存映射**，页表就想一个map，它记录了进程的虚拟内存的某个地址映射到物理内存中实际的地址。

进程访问虚拟内存的流程：

1. 当进程访问某块虚拟内存的数据时，首先去访问页表。页表有一个有效位和一个地址。
2. 若页表的有效位为1，表示这块数据在物理内存中，那么根据地址中记录的物理内存页号访问数据。
3. 若页表的有效位为0，表示这块数据在磁盘中，就会发生**缺页异常**。发生缺页异常时，操作系统立即阻塞此进程，并使用**页面置换算法**将磁盘中的数据拷入物理内存中，若物理内存中有剩余空间则直接拷入，若没有，则选择一页，将该页内容放入磁盘中，将需要使用的数据拷入该页，具体选择哪一页覆盖，取决于操作系统的页面置换算法。然后，将页表有效位置为1，地址栏填入新的物理内存页号，恢复该进程。